<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Plazos</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
        }

        div {
            margin: 8px 0;
        }

        label {
            margin-right: 10px;
        }

        input, button {
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        button {
            cursor: pointer;
            background-color: #28a745; /* Color verde */
            color: white;
            border: none;
            margin-top: 15px;
        }

        #fechaCierre {
            color: #333;
            font-weight: bold;
            margin-top: 20px;
        }

        /* Estilos para agrupar los radio buttons */
        fieldset {
            margin: 15px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
        }

        fieldset legend {
            font-weight: bold;
            padding: 0 5px;
        }

        fieldset div {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        fieldset input[type="radio"] {
            margin-right: 8px;
        }
    </style>
    </head>
<body>

    <h2>Calculadora de Fecha de Plazo</h2>
    
    <div>
        <label for="fechaInicio">Fecha de Inicio:</label>
        <input id="fechaInicio" type="date">
    </div>

    <fieldset>
        <legend>Tipo de Plazo:</legend>
        <div>
            <input type="radio" id="opHabiles" name="tipoPlazo" value="habiles" checked>
            <label for="opHabiles">Días Hábiles</label>
        </div>
        <div>
            <input type="radio" id="opCorridos" name="tipoPlazo" value="corridos">
            <label for="opCorridos">Días Corridos</label>
        </div>
    </fieldset>
    
    <div>
        <label for="diasPlazo">Plazo:</label>
        <input id="diasPlazo" type="number" value="10" min="1">
    </div>
    
    <button id="btnCalcular">Calcular Fecha</button>
    
    <h3 id="fechaCierre">La fecha aparecerá aquí</h3>

    <script>
        // --- 1. LISTA DE FERIADOS (Formato: 'YYYY-MM-DD') ---
        // ¡IMPORTANTE! Esta lista debe mantenerse actualizada anualmente.
        // (Feriados de ejemplo para Chile)
        const FERIADOS_CHILE = [
            '2024-01-01', '2024-03-29', '2024-05-01', '2024-05-21', '2024-09-18', '2024-09-19', '2024-10-31', '2024-11-01', '2024-12-25',
            '2025-01-01', '2025-04-18', '2025-05-01', '2025-05-21', '2025-09-18', '2025-09-19', '2025-10-31', '2025-11-01', '2025-12-25',
            '2025-11-03' // Feriado actual (ejemplo)
        ];
        // ----------------------------------------------------


        // --- 2. Función auxiliar para saber si un día es hábil ---
        function esDiaHabil(fecha) {
            const diaDeLaSemana = fecha.getDay();
            // 0 = Domingo, 6 = Sábado
            if (diaDeLaSemana === 0 || diaDeLaSemana === 6) {
                return false; // Fin de semana
            }
            
            // Formatear fecha a 'YYYY-MM-DD' para comparar
            const anio = fecha.getFullYear();
            const mes = (fecha.getMonth() + 1).toString().padStart(2, '0');
            const dia = fecha.getDate().toString().padStart(2, '0');
            const fechaString = `${anio}-${mes}-${dia}`;

            // Revisar si la fecha está en la lista de feriados
            if (FERIADOS_CHILE.includes(fechaString)) {
                return false; // Feriado
            }

            return true; // Es día hábil
        }
        // ----------------------------------------------------


        // --- 3. Event Listener Principal (Se ejecuta cuando la página carga) ---
        document.addEventListener('DOMContentLoaded', function() {

            // Encontrar todas las piezas HTML por su 'id'
            const inputFecha = document.getElementById('fechaInicio');
            const inputDias = document.getElementById('diasPlazo');
            const boton = document.getElementById('btnCalcular');
            const elResultado = document.getElementById('fechaCierre');

            // Definir qué hacer cuando se hace clic en el botón
            boton.addEventListener('click', function() {
                
                // 1. Obtener y validar los valores
                const diasDePlazo = parseInt(inputDias.value);
                const fechaInicioString = inputFecha.value;

                // 2. Obtener el tipo de plazo (hábil o corrido)
                // Busca el input con name="tipoPlazo" que esté seleccionado (:checked)
                const tipoPlazoSeleccionado = document.querySelector('input[name="tipoPlazo"]:checked').value;

                // Validar datos
                if (!fechaInicioString || isNaN(diasDePlazo) || diasDePlazo <= 0) {
                    elResultado.textContent = 'Error: Ingresa una fecha y días válidos.';
                    return; // Detiene la ejecución
                }

                // 3. Preparar la fecha de inicio
                // (Usamos split para crear la fecha y evitar problemas de zona horaria)
                const partesFecha = fechaInicioString.split('-');
                const fechaCalculada = new Date(partesFecha[0], partesFecha[1] - 1, partesFecha[2]); // Mes es 0-indexado (Ene=0)

                // 4. Lógica condicional (IF/ELSE)
                if (tipoPlazoSeleccionado === 'habiles') {
                    
                    // --- LÓGICA DE DÍAS HÁBILES ---
                    let diasHabilesContados = 0;
                    // Bucle: sigue sumando días HASTA QUE los contados lleguen al plazo
                    while (diasHabilesContados < diasDePlazo) {
                        // Suma 1 día calendario
                        fechaCalculada.setDate(fechaCalculada.getDate() + 1);
                        // Revisa si ESE día es hábil
                        if (esDiaHabil(fechaCalculada)) {
                            diasHabilesContados++; // Solo suma al contador si es hábil
                        }
                    }

                } else {
                    
                    // --- LÓGICA DE DÍAS CORRIDOS ---
                    // Simplemente suma los días de plazo a la fecha de inicio
                    fechaCalculada.setDate(fechaCalculada.getDate() + diasDePlazo);
                }

                // 5. Mostrar el Resultado
                // (Formateamos la fecha final a DD/MM/AAAA)
                const diaFinal = fechaCalculada.getDate().toString().padStart(2, '0');
                const mesFinal = (fechaCalculada.getMonth() + 1).toString().padStart(2, '0'); // Sumamos 1 al mes
                const anioFinal = fechaCalculada.getFullYear();
                
                elResultado.textContent = `La fecha de cierre es: ${diaFinal}/${mesFinal}/${anioFinal}`;
            });
        });
    </script>
    </body>
</html>


