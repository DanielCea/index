<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Plazos (v2.0)</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
        }

        div {
            margin: 8px 0;
        }

        label {
            margin-right: 10px;
        }

        input, button {
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        button {
            cursor: pointer;
            background-color: #28a745; /* Color verde */
            color: white;
            border: none;
            margin-top: 15px;
        }

        #fechaCierre {
            color: #333;
            font-weight: bold;
            margin-top: 20px;
        }

        fieldset {
            margin: 15px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            width: 250px; /* Ancho fijo para ordenar opciones */
        }

        fieldset legend {
            font-weight: bold;
            padding: 0 5px;
        }

        fieldset div {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        fieldset input[type="radio"] {
            margin-right: 8px;
        }
    </style>
    </head>
<body>

    <h2>Calculadora de Plazos</h2>
    
    <div>
        <label for="fechaInicio">Fecha de Inicio:</label>
        <input id="fechaInicio" type="date">
    </div>

    <fieldset>
        <legend>Tipo de Plazo:</legend>
        <div>
            <input type="radio" id="opHabiles" name="tipoPlazo" value="habiles" checked>
            <label for="opHabiles">Días Hábiles</label>
        </div>
        <div>
            <input type="radio" id="opCorridos" name="tipoPlazo" value="corridos">
            <label for="opCorridos">Días Corridos</label>
        </div>
        <div>
            <input type="radio" id="opSemanas" name="tipoPlazo" value="semanas">
            <label for="opSemanas">Semanas</label>
        </div>
        <div>
            <input type="radio" id="opMeses" name="tipoPlazo" value="meses">
            <label for="opMeses">Meses</label>
        </div>
    </fieldset>
    
    <div>
        <label for="cantidadPlazo">Plazo:</label>
        <input id="cantidadPlazo" type="number" value="10" min="1">
    </div>
    
    <button id="btnCalcular">Calcular Plazo</button>
    
    <h3 id="fechaCierre">La fecha aparecerá aquí</h3>

    <script>
        // --- 1. LISTA DE FERIADOS (Formato: 'YYYY-MM-DD') ---
        const FERIADOS_CHILE = [
            // Feriados 2024
            '2024-01-01', '2024-03-29', '2024-05-01', '2024-05-21', '2024-09-18', '2024-09-19', '2024-10-31', '2024-11-01', '2024-12-25',
            // Feriados 2025
            '2025-01-01', '2025-04-18', '2025-05-01', '2025-05-21', '2025-09-18', '2025-09-19', '2025-10-31', '2025-11-01', '2025-12-08', '2025-12-25',
            // Feriados 2026
            '2026-01-01', '2026-04-03', '2026-05-01', '2026-05-21', '2026-06-29', '2026-07-16', '2026-09-18', '2026-10-12', '2026-12-08', '2026-12-25'
        ];
        // ----------------------------------------------------


        // --- 2. Función auxiliar para saber si un día es hábil ---
        function esDiaHabil(fecha) {
            const diaDeLaSemana = fecha.getDay();
            // 0 = Domingo, 6 = Sábado
            if (diaDeLaSemana === 0 || diaDeLaSemana === 6) {
                return false; // Fin de semana
            }
            
            const anio = fecha.getFullYear();
            const mes = (fecha.getMonth() + 1).toString().padStart(2, '0');
            const dia = fecha.getDate().toString().padStart(2, '0');
            const fechaString = `${anio}-${mes}-${dia}`;

            if (FERIADOS_CHILE.includes(fechaString)) {
                return false; // Feriado
            }

            return true; // Es día hábil
        }
        // ----------------------------------------------------


        // --- 3. Event Listener Principal (Se ejecuta cuando la página carga) ---
        document.addEventListener('DOMContentLoaded', function() {

            // Encontrar todas las piezas HTML por su 'id'
            const inputFecha = document.getElementById('fechaInicio');
            const inputCantidad = document.getElementById('cantidadPlazo'); // ID actualizado
            const boton = document.getElementById('btnCalcular');
            const elResultado = document.getElementById('fechaCierre');

            boton.addEventListener('click', function() {
                
                // 1. Obtener y validar los valores
                const cantidadPlazo = parseInt(inputCantidad.value); // Variable actualizada
                const fechaInicioString = inputFecha.value;

                // 2. Obtener el tipo de plazo (hábil, corrido, semana, mes)
                const tipoPlazoSeleccionado = document.querySelector('input[name="tipoPlazo"]:checked').value;

                // Validar datos
                if (!fechaInicioString || isNaN(cantidadPlazo) || cantidadPlazo <= 0) {
                    elResultado.textContent = 'Error: Ingresa una fecha y cantidad válidas.';
                    return; 
                }

                // 3. Preparar la fecha de inicio
                const partesFecha = fechaInicioString.split('-');
                const fechaCalculada = new Date(partesFecha[0], partesFecha[1] - 1, partesFecha[2]); 

                // --- 4. LÓGICA CONDICIONAL MEJORADA (con if / else if) ---

                if (tipoPlazoSeleccionado === 'habiles') {
                    // --- LÓGICA DE DÍAS HÁBILES ---
                    let diasHabilesContados = 0;
                    while (diasHabilesContados < cantidadPlazo) {
                        fechaCalculada.setDate(fechaCalculada.getDate() + 1);
                        if (esDiaHabil(fechaCalculada)) {
                            diasHabilesContados++; 
                        }
                    }

                } else if (tipoPlazoSeleccionado === 'corridos') {
                    // --- LÓGICA DE DÍAS CORRIDOS ---
                    fechaCalculada.setDate(fechaCalculada.getDate() + cantidadPlazo);

                } else if (tipoPlazoSeleccionado === 'semanas') {
                    // --- NUEVA LÓGICA DE SEMANAS ---
                    const diasTotales = cantidadPlazo * 7;
                    fechaCalculada.setDate(fechaCalculada.getDate() + diasTotales);

                } else if (tipoPlazoSeleccionado === 'meses') {
                    // --- NUEVA LÓGICA DE MESES ---
                    // setMonth maneja automáticamente los cambios de año
                    // y los días de cada mes (ej: 31 Ene + 1 mes = 03 Mar)
                    fechaCalculada.setMonth(fechaCalculada.getMonth() + cantidadPlazo);
                }

                // --- 5. Mostrar el Resultado (Sin cambios) ---
                const diaFinal = fechaCalculada.getDate().toString().padStart(2, '0');
                const mesFinal = (fechaCalculada.getMonth() + 1).toString().padStart(2, '0'); 
                const anioFinal = fechaCalculada.getFullYear();
                
                elResultado.textContent = `La fecha de cierre es: ${diaFinal}/${mesFinal}/${anioFinal}`;
            });
        });
    </script>
    </body>
</html>
